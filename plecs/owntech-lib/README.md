# Plecs Owntech-lib

Contents:

* A Plecs library.
* python modules to help simulation loop.

## plecs library
This is a plecs library to add in your project if you want to use a twist board.

![](./images/owntech-lib.png =400x300)

There's also some useful control blocks to do classical pwm and modulations.

:warning: To use the library, you must add it in the plecs libraries path, opening
`PLECS Preferences`

![](./images/plecs_preferences.png =300x300)

## python scripts

Plecs propose a RPC interface. We use its property to 
automate simulations and then to sweep parameters using python scripts.

:warning: the Plecs RPC server must be enable in the `General` Pane of the `PLECS
Preferences`.

## `plecs_sweep_helper`
The `plecs_sweep_helper.py` is a module where there's one function `simul_plecs`

```python 
simul_plecs(model_path, model_name, scenarios, curve_names, init_time=1e-3, categories=None):
```

It launch multiple simulations of your model with parameter variations.

the parameter variations is inside a python dictionary named `scenarios`.

for example if you have two parameters : `f0, M, pwm_mode` and you want to sweep this three params.

```python 
scenarios =  {
    'f0': [50, 100],
    'M': [0.5, 0.6], 
    'pwm_mode': [1, 2]
}
```

In your model you must have an out port at the top level block and the `curve_names` is
a list of the name of the data you will recover (thus it should have the same size as
the out port).

if some parameters are discrete values and correspond to plecs model configurations, you
certainly want to name it as a category (like enumeration in C). That's why we propose a 
`categories` variable which is a mapping between names and values.
for example here the `pwm_mode` can be UNIPOLAR and BIPOLAR, then:

```python
categories = {'pwm_mode': {1: 'unipolar', 2: 'bipolar'}}
```

The results are json files with two main fields: 

1. `params`
2. `results`

the `params` field is a structure with the value of the parameters fixed for one
simulation.

The `results` is a dataset with the simulation values you want to save.
it's a capture of the output values (out port) at the top level block of your model.


## `plot_results`

Its a module with python functions which can help you to plot the results of your simulations.
It use the json files generated by the `simul_plecs` funciton. 

